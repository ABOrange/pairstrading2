# 更新日誌 (CHANGELOG)

所有對專案的重要更新都會記錄在此文件中。

## [未發布] - 2025-05-08

### 新增
- 回測系統增強功能：
  - 新增回測期間套利次數統計功能，用於評估交易策略的套利效率
  - 新增回測期間爆倉次數統計功能，用於評估槓桿風險
  - 在批量回測結果頁面添加系統設定顯示區域，展示入場閾值、出場閾值和槓桿值
  - 添加根據套利次數和爆倉次數的新篩選和排序功能
  - 優化交易對推薦算法，綜合考慮相關性、Z分數、套利次數和爆倉風險
- 爆倉風險評估模型：
  - 新增考慮槓桿倍數的爆倉閾值計算 (維持保證金率 = 0.8 / 槓桿倍數)
  - 在回測結果中展示爆倉風險評估
  - 實現精確的爆倉風險計算，基於資產價格變動和配對交易組合的風險
- 完整的專案文檔：更新了README.md文件，提供全面的專案說明、架構介紹和使用指南
- 系統架構詳細說明：添加了完整的系統架構圖和模組說明，幫助使用者更好地理解系統組成
- 開發者指南：新增了詳細的開發者指南，包括擴展交易對、自定義策略和改進風險管理的方法
- 專案結構說明：添加了更清晰的專案結構樹狀圖，標明了各模組的功能和關係

### 優化
- 回測統計與推薦功能強化：
  - 重構統計數據計算和展示邏輯，添加套利次數和爆倉次數統計
  - 優化推薦交易對的評分公式，綜合考慮四個關鍵因素：相關性、Z分數波動、套利機會和爆倉風險
  - 增強交易對篩選功能，支援按套利次數和爆倉風險進行篩選
  - 改進批量回測頁面UI，顯示系統當前配置參數
- 爆倉計算邏輯優化：
  - 優化爆倉閾值計算方法，由簡單的 1/槓桿 改為更符合實際交易所規則的 0.8/槓桿
  - 添加詳細的爆倉事件記錄和統計
  - 改進爆倉風險的可視化展示
- 更新README中關於技術棧的描述，加入了最新版本信息
- 優化專案文檔的格式和排版，提高閱讀體驗
- 完善使用指南，使系統配置過程更加清晰易懂
- 更新配對交易策略的詳細說明，包括核心原理和分析方法

### 修復
- 修復批量回測結果頁面中無法正確顯示套利次數和爆倉次數的問題
- 優化JavaScript代碼的錯誤處理，提高頁面穩定性
- 解決在統計數據處理中的空值處理問題，避免出現未定義值的錯誤
- 改進推薦交易對顯示邏輯，確保所有數據正確顯示

## [未發布]

### 新增
- 自動設定 Binance API BaseURL 功能：添加了在設定頁面上自動根據 testnetEnabled 參數自動設定 baseUrl 的功能
  - 當 testnetEnabled 為 true 時，自動將 baseUrl 設為幣安測試網絡 URL (https://testnet.binancefuture.com)
  - 當 testnetEnabled 為 false 時，自動將 baseUrl 設為幣安正式網絡 URL (https://fapi.binance.com)
  - 設定頁面上新增了測試網絡開關，用戶可直接在頁面上切換
  - 設定值從 application.yml 移至 H2 資料庫，支持動態修改
- 將交易窗口 (Window Size) 的預設值從 30 增加至 700，以提升交易算法的有效性和穩定性
- 優化設定頁面用戶界面，提供更直觀的API設定體驗

### 修改
- BinanceConfig 類：重構並移至 andy.crypto.pairstrading.bot.pairstrading.config 包
  - 新增自動更新 baseUrl 的邏輯
  - 加強與 ApiConfigService 的整合
- ApiConfigService 類：增加對 testnetEnabled 參數的支援，實現與 BinanceConfig 同步更新
- SettingsController 類：更新控制器以處理新的 testnetEnabled 參數和優化API設定流程
- api-config.html 頁面：新增 testnetEnabled 切換開關及相關提示，改進用戶界面

### 修復
- 優化前端 JavaScript 代碼，使測試網絡切換開關能夠即時更新 baseUrl 顯示
- 修復舊版 BinanceConfig 備援機制，確保系統能夠穩定運行